<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>HouseLearning Partner Program</title>
<script src="/feedback.js"></script>
<script src="https://www.google.com/recaptcha/api.js" async defer></script>
<script src="https://houselearning.org/cookiebanner.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://houselearning.org/home/main.js"></script>
<link rel="stylesheet" href="style.css">

<style>
main.partner-page { max-width: 900px; margin: 0 auto; padding: 20px 0 40px; }

.header-section {
  text-align: center;
  margin-bottom: 40px;
}
.header-section h1 {
  color: var(--primary);
  font-size: 36px;
  margin-bottom: 10px;
}
.header-section p {
  font-size: 18px;
  color: var(--muted);
}

.section {
  margin-bottom: 30px;
}

.section h2 {
  color: var(--primary);
  margin-bottom: 15px;
  font-size: 28px;
}
.section p { margin-bottom: 12px; }

.upload-card {
  max-width: 600px;
  margin: 0 auto;
}

.dropzone {
  border: 2px dashed rgba(0, 0, 0, 0.18);
  border-radius: 12px;
  padding: 25px;
  text-align: center;
  margin-bottom: 16px;
  cursor: pointer;
  transition: background 0.2s ease;
  color: var(--muted);
}
.dropzone.highlight { background: rgba(58, 134, 255, 0.05); border-color: var(--primary); }
.dropzone input { display: none; }

.progress-bar-bg {
  width: 100%;
  background: #e0e0e0;
  border-radius: 6px;
  overflow: hidden;
  margin-top: 14px;
  height: 18px;
}
.progress-bar-fill {
  height: 100%;
  width: 0%;
  background: var(--primary);
  transition: width 0.3s ease;
}

.message { margin-top: 14px; font-size: 15px; }
.success { color: #206520; }
.error { color: #8B0000; }
</style>
</head>
<body>

<div class="container">
  <header>
    <div class="brand">
      <div class="logo">HL</div>
      <div>
        <div style="font-weight:800">HouseLearning</div>
        <div style="font-size:12px;color:var(--muted);margin-top:2px">Learn anything — fast, free, focused</div>
      </div>
    </div>

    <nav>
      <a href="/home">Home</a>
      <a href="https://houselearning.org/safe-library">SafeLibrary</a>
      <a href="https://houselearning.org/home/about">About</a>
      <a href="https://apply.houselearning.org">Apply</a>
      <a href="https://github.com/houselearning">View on GitHub</a>
      <a class="button btn-ghost" href="https://houselearning.org/auth/">Log in</a>
      <a class="button btn-primary" href="https://houselearning.org/auth/">Sign up</a>
    </nav>
  </header>

  <main class="partner-page">

  <div class="header-section">
    <h1>HouseLearning Partner Program</h1>
    <p>Join our network of educational partners to collaborate, share content, and grow together.</p>
  </div>

  <div class="card section">
    <h2>What Being a Partner Means</h2>
    <p>Partners get access to domain support (*.houselearning.org), exclusive lesson content, blog contributions, interactive programs, GitHub inclusion, and more. Collaborate with us to enhance learning experiences worldwide.</p>
  </div>

  <div class="card section">
    <h2>How to Become a Partner</h2>
    <p>Download our Partnership Form, complete it, and upload it below to join our program. Ensure all fields are filled and the document includes the verification code.</p>
    <a class="button btn-primary" href="https://houselearning.org/meta/partner-form.pdf" target="_blank">Download PDF Form</a>
  </div>

  <div class="card upload-card">
    <h2>Upload Your Completed PDF</h2>
    <div id="dropzone" class="dropzone">
      Drag & Drop PDF here<br>or Click to Browse
      <input type="file" id="fileInput" accept="application/pdf">
    </div>

    <div class="progress-bar-bg">
      <div id="progressBar" class="progress-bar-fill"></div>
    </div>

    <div id="status" class="message"></div>
    <div class="g-recaptcha" data-sitekey="6LeNBUwsAAAAAMwDhp2LCD6iy_uDg0exFUxqNfFi"></div>
  </div>

</main>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
<script>
pdfjsLib.GlobalWorkerOptions.workerSrc = "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js";
</script>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDoXSwni65CuY1_32ZE8B1nwfQO_3VNpTw",
  authDomain: "contract-center-llc-10.firebaseapp.com",
  projectId: "contract-center-llc-10",
  storageBucket: "contract-center-llc-10.firebasestorage.app",
  messagingSenderId: "323221512767",
  appId: "1:323221512767:web:6421260f875997dbf64e8a",
  measurementId: "G-S2RJ0C6BWH"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const dropzone = document.getElementById("dropzone");
const fileInput = document.getElementById("fileInput");
const statusEl = document.getElementById("status");
const progressBar = document.getElementById("progressBar");

function updateProgress(percent) { progressBar.style.width = percent + "%"; }
function resetProgress() { updateProgress(0); }

async function handleFile(file) {
  statusEl.textContent = ""; resetProgress();

  const captchaResponse = grecaptcha.getResponse();
  if (!captchaResponse) {
    statusEl.textContent = "Please complete the CAPTCHA.";
    statusEl.className = "message error";
    return;
  }

  if (!file || file.type !== "application/pdf") {
    statusEl.textContent = "Please select a valid PDF.";
    statusEl.className = "message error";
    return;
  }

  const reader = new FileReader();
  reader.onprogress = (e) => {
    if (e.lengthComputable) updateProgress((e.loaded / e.total) * 20);
  };
  reader.onloadstart = () => { statusEl.textContent = "Reading PDF…"; };

  reader.onload = async () => {
    try {
      const arrayBuffer = reader.result;
      const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
      let markdownContent = "";
      let slides = [];
      const totalPages = pdf.numPages;
      const maxSlides = 2;

      for (let i = 1; i <= totalPages; i++) {
        const page = await pdf.getPage(i);

        // Text to Markdown
        const content = await page.getTextContent();
        const textItems = content.items.map(item => item.str);
        textItems.forEach(line => {
          if (line.trim().endsWith(":")) markdownContent += `## ${line.trim()}\n`;
          else markdownContent += `${line.trim()}\n`;
        });

        // Convert first 2 pages to base64 images
        if (i <= maxSlides) {
          const viewport = page.getViewport({ scale: 2 });
          const canvas = document.createElement("canvas");
          const context = canvas.getContext("2d");
          canvas.width = viewport.width;
          canvas.height = viewport.height;
          await page.render({ canvasContext: context, viewport }).promise;
          slides.push(canvas.toDataURL("image/png"));
        }

        updateProgress(20 + (i / totalPages) * 80);
      }

      if (!markdownContent.includes("35105")) {
        statusEl.textContent = "Verification code not found in PDF.";
        statusEl.className = "message error";
        resetProgress();
        return;
      }

      await addDoc(collection(db, "partner-deals"), {
        fileName: file.name,
        verified: true,
        captchaToken: captchaResponse,
        markdownContent,
        slides,
        submittedAt: serverTimestamp()
      });

      updateProgress(100);
      statusEl.textContent = "Uploaded! We'll review within 2–3 days.";
      statusEl.className = "message success";
      grecaptcha.reset();

    } catch (err) {
      statusEl.textContent = "Error processing PDF: " + err;
      statusEl.className = "message error";
      resetProgress();
    }
  };

  reader.readAsArrayBuffer(file);
}

dropzone.addEventListener("dragover", (e) => { e.preventDefault(); dropzone.classList.add("highlight"); });
dropzone.addEventListener("dragleave", () => { dropzone.classList.remove("highlight"); });
dropzone.addEventListener("drop", (e) => { e.preventDefault(); dropzone.classList.remove("highlight"); handleFile(e.dataTransfer.files[0]); });
dropzone.addEventListener("click", () => fileInput.click());
fileInput.addEventListener("change", () => handleFile(fileInput.files[0]));
</script>

<footer>
  <div class="footer-grid">
    <div>
      <div style="font-weight:800">HouseLearning</div>
      <div style="font-size:13px;color:var(--muted);margin-top:6px">© HouseLearning — free learning for curious people</div>
    </div>
    <div style="display:flex;gap:18px;align-items:center">
      <a href="https://houselearning.org/home/about">About</a>
      <a href="https://github.com/houselearning/apply?tab=readme-ov-file#available-volunteer-jobs">Careers</a>
    </div>
  </div>
</footer>
</div>

</body>
</html>
